# Улучшение конфигурации Jest с помощью псевдонимов модулей {#chapter-8}

В этой главе вы узнаете, как использовать псевдонимы модуля Jest, чтобы избежать использования относительных путей.

Менеджеры модулей, которые у нас есть в сообществе JavaScript, главным образом ES-модули и CommonJS, не поддерживают пути на основе проектов. Они поддерживают только относительные пути для наших собственных модулей и пути для каталога `node_modules`. Когда проект немного растёт, обычно встречаются такие пути:

{lang=javascript}
    import SomeComponent from '../../../../components/SomeComponent';

К счастью, у нас есть разные способы справиться с этим, таким образом мы могли определить псевдонимы для каталог относительно корня проекта, поэтому мы могли бы использовать написать приведённую выше строку так, как показано ниже:

{lang=javascript}
    import SomeComponent from '@/components/SomeComponent';

Знак `@` здесь является произвольным символом для определения корневого проекта, вы можете определить свой собственный. Давайте посмотрим, какие решения мы можем применить для псевдонимов модулей. Начнём [с того места, где мы остановились в предыдущей главе](https://github.com/alexjoverm/vue-testing-series/tree/test-slots).

## Псевдонимы Webpack

[Псевдонимы Webpack](https://webpack.js.org/configuration/resolve/#resolve-alias) очень просты в настройке. Вам просто нужно добавить свойство `resolve.alias` в конфигурацию вашего webpack. Если вы посмотрите на `build/webpack.base.conf.js`, там уже определён один псевдоним:

{lang=javascript}
    module.exports = {
      // ...
      resolve: {
        extensions: ['.js', '.vue', '.json'],
        alias: {
          'vue$': 'vue/dist/vue.esm.js',
        }
      }
    };

Принимая это как точку входа, мы можем добавить простой псевдоним, указывающий на папку `src`, и использовать его в качестве корня проекта:

{lang=javascript}
    module.exports = {
      // ...
      resolve: {
        extensions: ['.js', '.vue', '.json'],
        alias: {
          'vue$': 'vue/dist/vue.esm.js',
          '@': path.join(__dirname, '..', 'src')
        }
      }
    };

Теперь благодаря этому мы можем получить доступ к чему-либо, взяв корневой проект как символ `@`. Перейдём к `src/App.vue` и изменим импорт на эти два компонента:

{lang=javascript}
    import MessageList from '@/components/MessageList';
    import Message from '@/components/Message';
    // ...

И если мы запустим `npm start` и откроем браузер по URL-адресу `localhost: 8080`, это должно работать из коробки.

Однако, если мы попытаемся выполнить тесты, запустив `npm t`, мы увидим, что Jest не находит модули. Мы все ещё не настроили Jest для работы псевдонимов модулей. Итак, перейдём к `package.json`, где находится конфигурация Jest, и добавим `"@/([^\\.]*)$": "<rootDir>/src/$1"` в `moduleNameMapper`:

{lang=json}
    {
      "jest": {
        "moduleNameMapper": {
          "@(.*)$": "<rootDir>/src/$1",
          "^vue$": "vue/dist/vue.common.js"
        }
      }
    }

Давайте объясним это:

- `@(.*)$`: Что бы ни начиналось с символа `@` и продолжалось в буквальном смысле (`(.*)$`) до конца строки, группируя путь, используя скобки
- `<rootDir>/src/$1`: `<rootDir>` — специальное слово Jest, которое означает корневой каталог. Затем мы сопоставляем его с `src`, а с помощью `$1` мы добавляем любую составную часть из регулярного выражения `(.*)`.

Например, `@/components/MessageList` будет ссылаться на `../src/components/MessageList`, когда вы импортируете его из каталогов `src` или `test`.

Это действительно так. Теперь вы можете даже обновить файл `App.test.js`, чтобы использовать псевдоним, поскольку теперь он может использоваться в тестах:

{lang=javascript}
    import { shallowMount } from '@vue/test-utils'
    import App from "@/App"
    // ...

И это будет работать для файлов `.vue` и `.js`.

## Несколько псевдонимов

Очень часто для удобства используются несколько псевдонимов, поэтому вместо использования только `@` для определения корневого каталога вы можете использовать ещё многие другие. Например, предположим, что у вас есть каталог `actions` и `models`. Если вы создаёте псевдоним для каждого из них, а затем перемещаете каталоги, то вам просто нужно изменить псевдонимы вместо обновления всех выражений импорта на него по всей кодовой базе. Это мощь псевдонимов модулей, они делают вашу кодовую базу более удобной и чистой.

Давайте добавим псевдоним `components` в `build/webpack.base.conf.js`:

{lang=javascript}
    module.exports = {
      // ...
      resolve: {
        extensions: ['.js', '.vue', '.json'],
        alias: {
          'vue$': 'vue/dist/vue.esm.js',
          '@': path.join(__dirname, '..', 'src')
          'components': path.join(__dirname, '..', 'src', 'components')
        }
      }
    };

Затем нам просто нужно добавить его также в конфигурацию Jest в `package.json`:

{lang=json}
    {
      "jest": {
        "moduleNameMapper": {
          "@(.*)$": "<rootDir>/src/$1",
          "components(.*)$": "<rootDir>/src/components/$1",
          "^vue$": "vue/dist/vue.common.js"
        }
      }
    }

Вот так просто. Теперь мы можем попробовать в `App.vue` использовать обе формы:

{lang=javascript}
    import MessageList from 'components/MessageList';
    import Message from '@/components/Message';

Остановите и перезапустите выполнение тестов, и это должно работать, а также если вы запустите `npm start` и попробуйте, что из этого выйдет.

## Другие решения

Я видел [babel-plugin-webpack-alias](https://github.com/trayio/babel-plugin-webpack-alias), специально используемый для других фреймворков тестирования, таких как [mocha](https://mochajs.org/), который не имеет модуля-преобразователя (module mapper).

Я сам не пробовал, потому что с использованием Jest это не нужно, но если вы хотите попробовать, пожалуйста, поделитесь результатом!

## Вывод

Добавление псевдонимов модулей очень просто и может держать вашу кодовую базу намного чище и проще в обслуживании. Jest упрощает их определение, вам просто нужно поддерживать синхронизацию с псевдонимами Webpack, и вы можете прощаться с адом относительных путей.

Полный пример вы можете найти на [GitHub](https://github.com/alexjoverm/vue-testing-series/tree/Enhance-Jest-configuration-with-Module-Aliases).
